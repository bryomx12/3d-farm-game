<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emerald Farm 3D</title>
    <script src="https://unpkg.com/three@0.150.0/build/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #0a210f; font-family: sans-serif; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; }
        #overlay { 
            position: absolute; inset: 0; background: rgba(0,0,0,0.85); 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; color: gold; z-index: 10;
        }
        button { 
            padding: 15px 40px; font-size: 20px; background: gold; border: none; 
            cursor: pointer; font-weight: bold; border-radius: 10px; margin-top: 20px;
        }
        .bubble {
            position: absolute; background: white; color: blue; padding: 5px 10px;
            border-radius: 10px; border: 2px solid blue; font-weight: bold; transform: translate(-50%, -100%);
        }
    </style>
</head>
<body>
    <div id="ui">
        <h1 id="money">ðŸ’° 100g</h1>
        <p id="inv">Inventory: 0/3</p>
    </div>

    <div id="overlay">
        <h1 style="font-size: 48px;">RUSTIC HARVEST</h1>
        <p style="color: white;">WASD to Move | Click to Farm</p>
        <button onclick="startGame()">START GAME</button>
    </div>

    <script>
        // --- GAME ENGINE ---
        let scene, camera, renderer, player, clock;
        let money = 100;
        let inventory = [];
        let keys = {};

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a210f);
            camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(15, 15, 15);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            clock = new THREE.Clock();

            // Lighting
            const amb = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(amb);
            const dir = new THREE.DirectionalLight(0xffffff, 1);
            dir.position.set(10, 20, 10);
            dir.castShadow = true;
            scene.add(dir);

            // Emerald Grass
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(100, 100),
                new THREE.MeshStandardMaterial({ color: 0x1b5e20 })
            );
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Chibi Player
            player = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1, 0.6), new THREE.MeshStandardMaterial({color: 0xffd600}));
            body.position.y = 0.5;
            body.castShadow = true;
            player.add(body);
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.35), new THREE.MeshStandardMaterial({color: 0xffdbac}));
            head.position.y = 1.2;
            player.add(head);
            scene.add(player);

            // Chicken Coop
            const coop = new THREE.Mesh(new THREE.BoxGeometry(3, 2, 3), new THREE.MeshStandardMaterial({color: 0x5d4037}));
            coop.position.set(-6, 1, 4);
            coop.userData = { type: 'coop' };
            scene.add(coop);

            // Vegetable Patch
            const patch = new THREE.Mesh(new THREE.PlaneGeometry(3, 3), new THREE.MeshStandardMaterial({color: 0x3e2723}));
            patch.rotation.x = -Math.PI / 2;
            patch.position.set(6, 0.01, -4);
            patch.userData = { type: 'patch' };
            scene.add(patch);

            window.addEventListener('keydown', (e) => keys[e.code] = true);
            window.addEventListener('keyup', (e) => keys[e.code] = false);
            window.addEventListener('mousedown', onMouseDown);
            animate();
        }

        function onMouseDown(event) {
            const mouse = new THREE.Vector2(
                (event.clientX / window.innerWidth) * 2 - 1,
                -(event.clientY / window.innerHeight) * 2 + 1
            );
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children);

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                if (obj.userData.type === 'coop' || (obj.parent && obj.parent.userData.type === 'coop')) {
                    collect('egg');
                }
            }
        }

        function collect(item) {
            if (inventory.length < 3) {
                inventory.push(item);
                document.getElementById('inv').innerText = `Inventory: ${inventory.length}/3`;
            }
        }

        function startGame() {
            document.getElementById('overlay').style.display = 'none';
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            if (document.getElementById('overlay').style.display === 'none') {
                const move = new THREE.Vector3(0, 0, 0);
                if (keys['KeyW'] || keys['ArrowUp']) move.z -= 1;
                if (keys['KeyS'] || keys['ArrowDown']) move.z += 1;
                if (keys['KeyA'] || keys['ArrowLeft']) move.x -= 1;
                if (keys['KeyD'] || keys['ArrowRight']) move.x += 1;

                if (move.length() > 0) {
                    move.normalize().multiplyScalar(10 * delta);
                    player.position.add(move);
                    player.rotation.y = Math.atan2(move.x, move.z);
                    
                    camera.position.lerp(new THREE.Vector3(player.position.x + 12, 12, player.position.z + 12), 0.1);
                    camera.lookAt(player.position);
                }
            }
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
